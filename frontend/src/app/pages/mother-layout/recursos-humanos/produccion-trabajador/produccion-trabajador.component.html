<div class="admin-perfiles-container" (click)="deseleccionarFila($event)">
  
    <button mat-raised-button color="primary" (click)="openModal('crearTrabajador')">Crear Trabajador</button>
    
    <button mat-raised-button color="primary" [disabled]="!(selectedRows.length>0 && selectedRows.length<2)" (click)="openModal('modificarTrabajador'); $event.stopPropagation()">Modificar Trabajador</button>
  
    <button mat-raised-button color="primary" [disabled]="!(selectedRows.length>0)" (click)="eliminarTrabajadoresSeleccionados()">Eliminar Trabajador</button>
    
    <div id="modalCrearTrabajador" class="modal-trabajadores" *ngIf="modals['crearTrabajador']" (click)="closeModal('crearTrabajador')">
        <div class="modal-content" (click)="$event.stopPropagation()">
            <div class="modal-header">
                <div class="header-bar"></div>
                <div class="title-container">
                    <h2>Crear Trabajador</h2>
                </div>
            </div>
            
            <h4 class="h4-subtitle">Nombre Trabajador:</h4>
            <input type="text" class="input-perfil" id="nombrePerfil" name="nombrePerfil" [(ngModel)]="nombreTrabajador" (ngModelChange)="nombreTrabajador = $event.toUpperCase()"><br><br>
            
            <h4 class="h4-subtitle">RUT Trabajador:</h4>
            <input type="text" class="input-perfil" id="nombreUsuario" name="rutUsuario" [(ngModel)]="rutTrabajador"  (input)="formatRUT($event)"><br><br>
  
            <h4 class="h4-subtitle">Correo Trabajador:</h4>
            <input type="text" class="input-perfil" id="nombreUsuario" name="correoUsuario" [(ngModel)]="correoTrabajador" ><br><br>
  
            <h4 class="h4-subtitle">Direccion Trabajador:</h4>
            <input type="text" class="input-perfil" id="nombreUsuario" name="direccionUsuario" [(ngModel)]="direccionTrabajador" ><br><br>
  
            <h4 class="h4-subtitle">Sexo:</h4>
            <div class="input-container">
                <select class="input-perfil" [(ngModel)]="sexoTrabajador">
                    <option value="Hombre">Hombre</option>
                    <option value="Mujer">Mujer</option>
                </select>
            </div>
            <br><br>
  
            <h4 class="h4-subtitle">Telefono Trabajador:</h4>
            <div class="input-container">
              <span class="prefix">+56</span>
              <input type="text" class="input-perfil" id="telefonoTrabajador" name="telefonoTrabajador" [(ngModel)]="telefonoTrabajador"  (keypress)="validateNumber($event)">
            </div>
  
            <button mat-raised-button class="table-button" (click)="openModal('sociedadesModal')" >SELECCIONAR SOCIEDAD</button>
            <!-- Modal para selección de sociedades -->
            <div id="sociedadesModales" class="modal-perfiles" *ngIf="modals['sociedadesModal']">
              <div class="mini-modal">
                <div class="dropdown">
                  <button class="dropdown-button" (click)="toggleDropdown()">SELECCIONAR SOCIEDAD</button>
                  <div id="sociedades-dropdown" class="dropdown-content" [class.show]="dropdownOpen"> 
                    <ng-container *ngFor="let sociedad of sociedadesCargadas">
                      <label [class.disabled]="selectedSociedadId !== null && selectedSociedadId !== sociedad.id">
                        <input type="checkbox"
                          [checked]="selectedSociedadId === sociedad.id"
                          (change)="toggleSelectionSociedad(sociedad.id)"
                          [disabled]="selectedSociedadId !== null && selectedSociedadId !== sociedad.id">
                        {{ sociedad.nombre }}
                      </label>
                    </ng-container>
                </div>
              </div>
              <button class="custom-button-sociedades" (click)="closeModal('sociedadesModal')">OK</button>
              </div>
            </div>
            
            <button mat-raised-button class="table-button" (click)="openModal('clientesModal')">SELECCIONAR CLIENTE</button>
            <!-- Modal para selección de clientes -->
            <div id="sociedadesModales" class="modal-perfiles" *ngIf="modals['clientesModal']">
              <div class="mini-modal">
                <div class="dropdown">
                  <button class="dropdown-button" (click)="toggleDropdown()">SELECCIONAR CLIENTE</button>
                  <div id="sociedades-dropdown" class="dropdown-content" [class.show]="dropdownOpen"> 
                    <ng-container *ngFor="let cliente of clientesCargados">
                      <label [class.disabled]="selectedClienteId !== null && selectedClienteId !== cliente.id">
                        <input type="checkbox"
                          [checked]="selectedClienteId === cliente.id"
                          (change)="toggleSelectionCliente(cliente.id)"
                          [disabled]="selectedClienteId !== null && selectedClienteId !== cliente.id">
                        {{ cliente.nombre }}
                      </label>
                    </ng-container>
                </div>
              </div>
              <button class="custom-button-sociedades" (click)="closeModal('clientesModal')">OK</button>
              </div>
            </div>
  
            <button mat-raised-button class="table-button" (click)="openModal('camposModal')">SELECCIONAR FUNDO</button>
            <!-- Modal para selección de clientes -->
            <div id="sociedadesModales" class="modal-perfiles" *ngIf="modals['camposModal']">
              <div class="mini-modal">
                <div class="dropdown">
                  <button class="dropdown-button" (click)="toggleDropdown()">SELECCIONAR FUNDO</button>
                  <div id="sociedades-dropdown" class="dropdown-content" [class.show]="dropdownOpen"> 
                    <ng-container *ngFor="let campo of camposCargados">
                      <label [class.disabled]="selectedCampoId !== null && selectedCampoId !== campo.id">
                        <input type="checkbox"
                          [checked]="selectedCampoId === campo.id"
                          (change)="toggleSelectionCampo(campo.id)"
                          [disabled]="selectedCampoId !== null && selectedCampoId !== campo.id">
                        {{ campo.nombre_campo }}
                      </label>
                    </ng-container>
                </div>
              </div>
              <button class="custom-button-sociedades" (click)="closeModal('camposModal')">OK</button>
              </div>
            </div>
  
            <button mat-raised-button class="table-button" (click)="openModal('areasModal')">SELECCIONAR AREA</button>
            <!-- Modal para selección de Areas -->
            <div id="AreasModales" class="modal-perfiles" *ngIf="modals['areasModal']">
              <div class="mini-modal">
                <div class="dropdown">
                  <button class="dropdown-button" (click)="toggleDropdown()">SELECCIONAR AREA</button>
                  <div id="area-dropdown" class="dropdown-content" [class.show]="dropdownOpen"> 
                    <ng-container *ngFor="let area of areasCargadas">
                      <label [class.disabled]="selectedAreaId !== null && selectedAreaId !== area.id">
                        <input type="checkbox"
                          [checked]="selectedAreaId === area.id"
                          (change)="toggleSelectionArea(area.id)"
                          [disabled]="selectedAreaId !== null && selectedAreaId !== area.id">
                        {{ area.nombre }}
                      </label>
                    </ng-container>
                  </div>
                </div>
                <button class="custom-button-sociedades" (click)="closeModal('areasModal')">OK</button>
              </div>
            </div>
            
            <button mat-raised-button class="table-button" (click)="openModal('cargosModal')">SELECCIONAR CARGO</button>
            <!-- Modal para selección de Cargos -->
            <div id="CargosModales" class="modal-perfiles" *ngIf="modals['cargosModal']">
                <div class="mini-modal">
                    <div class="dropdown">
                        <button class="dropdown-button" (click)="toggleDropdown()">SELECCIONAR CARGO</button>
                        <div id="area-dropdown" class="dropdown-content" [class.show]="dropdownOpen"> 
                        <ng-container *ngFor="let cargo of cargosCargados">
                            <label [class.disabled]="selectedCargoId !== null && selectedCargoId !== cargo.id">
                                <input type="checkbox"
                                    [checked]="selectedCargoId === cargo.id"
                                    (change)="toggleSelectionCargo(cargo.id)"
                                    [disabled]="selectedCargoId !== null && selectedCargoId !== cargo.id">
                                {{ cargo.nombre }}
                            </label>
                        </ng-container>
                    </div>
                </div>
                <button class="custom-button-sociedades" (click)="closeModal('cargosModal')">OK</button>
                </div>
            </div>
            
            <button mat-raised-button class="table-button" (click)="openModal('afpModal')">SELECCIONAR AFP</button>
            <!-- Modal para selección de AFP -->
            <div id="afpModales" class="modal-perfiles" *ngIf="modals['afpModal']">
              <div class="mini-modal">
                <div class="dropdown">
                  <button class="dropdown-button" (click)="toggleDropdown()">SELECCIONAR AFP</button>
                  <div id="area-dropdown" class="dropdown-content" [class.show]="dropdownOpen"> 
                    <ng-container *ngFor="let afp of afpCargadas">
                      <label [class.disabled]="selectedAfpId !== null && selectedAfpId !== afp.id">
                        <input type="checkbox"
                        [checked]="selectedAfpId === afp.id"
                        (change)="toggleSelectionAFP(afp.id)"
                        [disabled]="selectedAfpId !== null && selectedAfpId !== afp.id">
                        {{ afp.nombre }}
                      </label>
                    </ng-container>
                  </div>
                </div>
                <button class="custom-button-sociedades" (click)="closeModal('afpModal')">OK</button>
              </div>
            </div>
  
            <button mat-raised-button class="table-button" (click)="openModal('saludModal')">SELECCIONAR SALUD</button>
            <!-- Modal para selección de Salud -->
            <div id="saludModales" class="modal-perfiles" *ngIf="modals['saludModal']">
                <div class="mini-modal">
                    <div class="dropdown">
                        <button class="dropdown-button" (click)="toggleDropdown()">SELECCIONAR SALUD</button>
                        <div id="area-dropdown" class="dropdown-content" [class.show]="dropdownOpen"> 
                        <ng-container *ngFor="let salud of saludCargadas">
                            <label [class.disabled]="selectedSaludId !== null && selectedSaludId !== salud.id">
                                <input type="checkbox"
                                    [checked]="selectedSaludId === salud.id"
                                    (change)="toggleSelectionSalud(salud.id)"
                                    [disabled]="selectedSaludId !== null && selectedSaludId !== salud.id">
                                {{ salud.nombre }}
                            </label>
                        </ng-container>
                    </div>
                </div>
                <button class="custom-button-sociedades" (click)="closeModal('saludModal')">OK</button>
                </div>
            </div>
  
            <h3>Ingrese la Fecha de Ingreso:</h3>
            <input type="date" class="input-perfil" placeholder="Fecha de Celebración" [(ngModel)]="fechaIngreso"><br>
  
             <!-- Metodo de Pago -->
            <h4 class="h4-subtitle">Metodo de Pago:</h4>
            <div class="input-container">
                <select class="input-perfil" [(ngModel)]="metodoPago" (change)="onMetodoPagoChange($event)">
                    <option value="Sin Pago">Sin Pago</option>
                    <option value="Efectivo">Efectivo</option>
                    <option value="Transferencia">Transferencia</option>
                </select>
            </div>
            <br><br>
  
            <!-- Campos adicionales para Transferencia -->
            <div *ngIf="metodoPago === 'Transferencia'">
                <h4 class="h4-subtitle">Banco:</h4>
                <input type="text" class="input-perfil" id="banco" name="banco" [(ngModel)]="banco">
                <br><br>
  
                <h4 class="h4-subtitle">Tipo de Cuenta:</h4>
                <input type="text" class="input-perfil" id="tipoCuenta" name="tipoCuenta" [(ngModel)]="tipoCuenta">
                <br><br>
  
                <h4 class="h4-subtitle">Numero de Cuenta:</h4>
                <input type="text" class="input-perfil" id="numeroCuenta" name="numeroCuenta" [(ngModel)]="numeroCuenta" (keypress)="validateNumber($event)">
                <br><br>
            </div>
  
            <button class="custom-button-ingreso"  (click)="crearTrabajador()" id="ingresarHoldingBtn">Ingresar Trabajador</button>
        </div>
    </div>
    
    <div id="modalmodificarTrabajador" class="modal-perfiles" *ngIf="modals['modificarTrabajador']">
      <div class="modal-content">
          <div class="modal-header">
              <span class="close" (click)="closeModal('modificarTrabajador')">&times;</span>
              <div class="header-bar"></div>
              <div class="title-container">
                <h2>Modificar Perfil {{trabajadorSeleccionado.nombre_perfil_seleccionado}}</h2>
            </div>
          </div>
          
          <h3>Nuevo Nombre Perfil:</h3>
  
          <input type="text" class="input-perfil" id="nombrePerfilNew" name="nombrePerfilNew" [(ngModel)]="nombreTrabajadorNew" (ngModelChange)="nombreTrabajadorNew = $event.toUpperCase()"><br><br>
          
          <button mat-raised-button class="table-button" (click)="openModal('sociedadesModal')">Modificar Sociedad(es)</button>
  
          <!-- Modal para selección de sociedades -->
          <div id="sociedadesModales" class="modal-perfiles" *ngIf="modals['sociedadesModal']">
            <div class="mini-modal">
              <div class="dropdown">
                <button class="dropdown-button" (click)="toggleDropdown()">SELECCIONAR SOCIEDADES</button>
                <div id="sociedades-dropdown" class="dropdown-content" [class.show]="dropdownOpen"> 
                  <ng-container *ngFor="let sociedad of sociedadesCargadas">
                    <label [class.disabled]="selectedSociedadId !== null && selectedSociedadId !== sociedad.id">
                      <input type="checkbox"
                        [checked]="selectedSociedadId === sociedad.id"
                        (change)="toggleSelectionArea(sociedad.id)"
                        [disabled]="selectedSociedadId !== null && selectedSociedadId !== sociedad.id">
                      {{ sociedad.nombre }}
                    </label>
                  </ng-container>
                </div>
              </div>
              <button class="custom-button-sociedades" (click)="closeModal('sociedadesModal')">OK</button>
            </div>
          </div>
          
          <button class="custom-button-ingreso"  (click)="modificarTrabajadores()" id="ingresarHoldingBtn">Modificar Perfil</button>
      </div>
    </div>
    
    <table mat-table [dataSource]="produccionesCargadas" class="mat-elevation-z8" (click)="$event.stopPropagation()">
      
      <ng-container matColumnDef="codigo">
        <th mat-header-cell *matHeaderCellDef class="mat-header"> Codigo </th>
        <td mat-cell *matCellDef="let produccion" class="mat-cell"> {{produccion.id}} </td>
      </ng-container>
  
      <ng-container matColumnDef="sociedad">
          <th mat-header-cell *matHeaderCellDef class="mat-header"> Sociedad </th>
          <td mat-cell *matCellDef="let produccion" class="mat-cell"> {{produccion.nombre_sociedad}} </td>
      </ng-container>
  
      <ng-container matColumnDef="supervisor">
          <th mat-header-cell *matHeaderCellDef class="mat-header"> Supervisor </th>
          <td mat-cell *matCellDef="let produccion" class="mat-cell"> {{produccion.nombre_supervisor}} </td>
      </ng-container>
  
      <ng-container matColumnDef="nombre_trabajador">
          <th mat-header-cell *matHeaderCellDef class="mat-header"> Nombre Trabajador </th>
          <td mat-cell *matCellDef="let produccion" class="mat-cell"> {{produccion.nombre_trabajador}} </td>
      </ng-container>
  
      <ng-container matColumnDef="nombre_labor">
        <th mat-header-cell *matHeaderCellDef class="mat-header"> Labor </th>
        <td mat-cell *matCellDef="let produccion" class="mat-cell"> {{produccion.nombre_labor}} </td>
      </ng-container>
  
      <ng-container matColumnDef="nombre_unidad_control">
        <th mat-header-cell *matHeaderCellDef class="mat-header"> U. Control </th>
        <td mat-cell *matCellDef="let produccion" class="mat-cell"> {{produccion.nombre_unidad_control}} </td>
      </ng-container>
      
      <ng-container matColumnDef="folio">
          <th mat-header-cell *matHeaderCellDef class="mat-header"> Folio </th>
          <td mat-cell *matCellDef="let produccion" class="mat-cell"> {{produccion.folio}} </td>
      </ng-container>
  
      <ng-container matColumnDef="valor_pago_trabajador">
          <th mat-header-cell *matHeaderCellDef class="mat-header"> Valor Pago Trabajador </th>
          <td mat-cell *matCellDef="let produccion" class="mat-cell"> {{produccion.valor_pago_trabajador}} </td>
      </ng-container>
  
      <ng-container matColumnDef="horas">
          <th mat-header-cell *matHeaderCellDef class="mat-header"> Horas </th>
          <td mat-cell *matCellDef="let produccion" class="mat-cell"> {{produccion.horas}} </td>
      </ng-container>
  
      <ng-container matColumnDef="fecha_ingreso_produccion">
        <th mat-header-cell *matHeaderCellDef class="mat-header"> Fecha de Ingreso </th>
        <td mat-cell *matCellDef="let produccion" class="mat-cell"> {{produccion.fecha_ingreso_produccion}} </td>
      </ng-container>
  
      <tr mat-header-row *matHeaderRowDef="columnasDesplegadas"></tr>
  
      <tr mat-row *matRowDef="let row; columns: columnasDesplegadas;" [class.selected]="isSelected(row)"  (click)="selectRow(row)"></tr>
    </table>
  </div>
  
  <div id="exitoModal" class="modal-perfiles" *ngIf="modals['exitoModal']">
    <div class="modal-content">
        <h2 style="color:white;">¡Éxito!</h2>
        <div class="exito-message" id="exitoText"></div>
        <button class="custom-button" (click)="closeModal('exitoModal')" >Cerrar</button>
    </div>
  </div>
  
  <div id="errorModal" class="modal-perfiles" *ngIf="modals['errorModal']">
    <div class="modal-content">
        <h2 style="color:white;">¡Error!</h2>
        <div class="error-icon-container">
            <i class="fas fa-exclamation-triangle icon-exclamation-triangle"></i>
        </div>
        <div class="error-message" style="color:white;">{{ errorMessage }}</div>
        <button class="custom-button" (click)="closeModal('errorModal')">Cerrar</button>
    </div>
  </div>
  