<div class="admin-container">

  <!-- SECCIÓN HABERES -->
  <div class="admin-haberes">
    <div class="admin-usuarios-container" (click)="deselectHaberRows($event)">
      <button mat-raised-button color="primary" (click)="openModal('crearHaber')">Crear Haber</button>

      <div id="modalCrearHaber" class="modal-perfiles" *ngIf="modals['crearHaber']" (click)="closeModal('crearHaber')">
        <div class="modal-content" (click)="$event.stopPropagation()">
          <div class="modal-header">
            <div class="header-bar"></div>
            <div class="title-container">
              <h2>Crear Haber</h2>
            </div>
            <span class="close" (click)="closeModal('crearHaber')">&times;</span>
          </div>
          
          <div class="form-row">
            <label for="nombreHaber">Nombre:</label>
            <input type="text" id="nombreHaber" [(ngModel)]="nuevoHaber.nombre" (ngModelChange)="nuevoHaber.nombre = $event.toUpperCase()">
          </div>
          
          <div class="form-row checkbox-row">
            <label>Imponible:</label>
            <input type="checkbox" [(ngModel)]="nuevoHaber.imponible">
          </div>
          
          <div class="form-row">
            <label for="ordenHaber">Orden:</label>
            <input type="number" id="ordenHaber" [(ngModel)]="nuevoHaber.orden">
          </div>
          
          <div class="form-row">
            <label for="tipoValorHaber">Tipo de Valor:</label>
            <select id="tipoValorHaber" [(ngModel)]="nuevoHaber.tipo_valor">
              <option value="CANTIDAD">Por Cantidad</option>
              <option value="MONTO">Monto Fijo</option>
            </select>
          </div>
          
          <div class="form-row">
            <label for="cuentaContable1">Cuenta Contable 1:</label>
            <input type="text" id="cuentaContable1" [(ngModel)]="nuevoHaber.cuenta_contable_1">
          </div>
          
          <div class="form-row">
            <label for="cuentaContable2">Cuenta Contable 2:</label>
            <input type="text" id="cuentaContable2" [(ngModel)]="nuevoHaber.cuenta_contable_2">
          </div>
          
          <div class="form-row">
            <label for="ubicacionLiquidacion">Ubicación Liquidación:</label>
            <input type="text" id="ubicacionLiquidacion" [(ngModel)]="nuevoHaber.ubicacion_liquidacion">
          </div>
          
          <button class="custom-button-ingreso" id="crearHaberBtn" (click)="crearHaberes()">Crear Haber</button>
        </div>
      </div>

      <div id="modalModificarHaber" class="modal-perfiles" *ngIf="modals['modificarHaber']">
        <div class="modal-content">
          <div class="modal-header">
            <span class="close" (click)="closeModal('modificarHaber')">&times;</span>
            <div class="header-bar"></div>
            <div class="title-container">
              <h2>Modificar Haber</h2>
            </div>
          </div>
          
          <div class="form-row">
            <label for="nombreHaberMod">Nombre:</label>
            <input type="text" id="nombreHaberMod" [(ngModel)]="haberSeleccionado.nombre_haber_seleccionado" (ngModelChange)="haberSeleccionado.nombre_haber_seleccionado = $event.toUpperCase()">
          </div>
          
          <div class="form-row checkbox-row">
            <label>Imponible:</label>
            <input type="checkbox" [(ngModel)]="haberSeleccionado.imponible_haber_seleccionado">
          </div>
          
          <div class="form-row">
            <label for="ordenHaberMod">Orden:</label>
            <input type="number" id="ordenHaberMod" [(ngModel)]="haberSeleccionado.orden_haber_seleccionado">
          </div>
          
          <div class="form-row">
            <label for="tipoValorHaberMod">Tipo de Valor:</label>
            <select id="tipoValorHaberMod" [(ngModel)]="haberSeleccionado.tipo_valor_haber_seleccionado">
              <option value="CANTIDAD">Por Cantidad</option>
              <option value="MONTO">Monto Fijo</option>
            </select>
          </div>
          
          <div class="form-row">
            <label for="cuentaContable1Mod">Cuenta Contable 1:</label>
            <input type="text" id="cuentaContable1Mod" [(ngModel)]="haberSeleccionado.cuenta_contable_1_haber_seleccionado">
          </div>
          
          <div class="form-row">
            <label for="cuentaContable2Mod">Cuenta Contable 2:</label>
            <input type="text" id="cuentaContable2Mod" [(ngModel)]="haberSeleccionado.cuenta_contable_2_haber_seleccionado">
          </div>
          
          <div class="form-row">
            <label for="ubicacionLiquidacionMod">Ubicación Liquidación:</label>
            <input type="text" id="ubicacionLiquidacionMod" [(ngModel)]="haberSeleccionado.ubicacion_liquidacion_haber_seleccionado">
          </div>
          
          <button class="custom-button-ingreso" (click)="modificarHaberes()">Guardar Cambios</button>
        </div>
      </div>

      <button mat-raised-button color="primary" [disabled]="!(selectedHaberRows.length === 1)" (click)="openModal('modificarHaber')">Modificar Haber</button>
      <button mat-raised-button color="primary" [disabled]="!(selectedHaberRows.length > 0)" (click)="openModal('confirmacionModal', 'haber')">Eliminar Haber(es)</button>

      <table mat-table [dataSource]="haberesCargados" class="mat-elevation-z8" (click)="$event.stopPropagation()">
        <ng-container matColumnDef="id">
          <th mat-header-cell *matHeaderCellDef class="mat-header"> ID </th>
          <td mat-cell *matCellDef="let haber" class="mat-cell"> {{ haber.id }} </td>
        </ng-container>
        
        <ng-container matColumnDef="nombre">
          <th mat-header-cell *matHeaderCellDef class="mat-header"> Nombre </th>
          <td mat-cell *matCellDef="let haber" class="mat-cell"> {{ haber.nombre }} </td>
        </ng-container>
        
        <ng-container matColumnDef="imponible">
          <th mat-header-cell *matHeaderCellDef class="mat-header"> Imponible </th>
          <td mat-cell *matCellDef="let haber" class="mat-cell"> {{ haber.imponible ? 'Sí' : 'No' }} </td>
        </ng-container>
        
        <ng-container matColumnDef="tipo_valor">
          <th mat-header-cell *matHeaderCellDef class="mat-header"> Tipo de Valor </th>
          <td mat-cell *matCellDef="let haber" class="mat-cell"> {{ getTipoValorText(haber.tipo_valor) }} </td>
        </ng-container>
        
        <ng-container matColumnDef="orden">
          <th mat-header-cell *matHeaderCellDef class="mat-header"> Orden </th>
          <td mat-cell *matCellDef="let haber" class="mat-cell"> {{ haber.orden }} </td>
        </ng-container>
        
        <tr mat-header-row *matHeaderRowDef="columnasDesplegadasHaberes"></tr>
        <tr mat-row *matRowDef="let row; columns: columnasDesplegadasHaberes;" [class.selected]="isHaberSelected(row)" (click)="selectHaberRow(row)"></tr>
      </table>
    </div>
  </div>

  <!-- SECCIÓN DESCUENTOS -->
  <div class="admin-descuentos">
    <div class="admin-usuarios-container" (click)="deselectDescuentoRows($event)">
      <button mat-raised-button color="primary" (click)="openModal('crearDescuento')">Crear Descuento</button>

      <div id="modalCrearDescuento" class="modal-perfiles" *ngIf="modals['crearDescuento']" (click)="closeModal('crearDescuento')">
        <div class="modal-content" (click)="$event.stopPropagation()">
          <div class="modal-header">
            <div class="header-bar"></div>
            <div class="title-container">
              <h2>Crear Descuento</h2>
            </div>
            <span class="close" (click)="closeModal('crearDescuento')">&times;</span>
          </div>
          
          <div class="form-row">
            <label for="nombreDescuento">Nombre:</label>
            <input type="text" id="nombreDescuento" [(ngModel)]="nuevoDescuento.nombre" (ngModelChange)="nuevoDescuento.nombre = $event.toUpperCase()">
          </div>
          
          <div class="form-row">
            <label for="ordenDescuento">Orden:</label>
            <input type="number" id="ordenDescuento" [(ngModel)]="nuevoDescuento.orden">
          </div>
          
          <div class="form-row checkbox-row">
            <label>Pago en cuotas:</label>
            <input type="checkbox" [(ngModel)]="nuevoDescuento.cuota">
          </div>
          
          <div class="form-row">
            <label for="cuentaContableDescuento">Cuenta Contable:</label>
            <input type="text" id="cuentaContableDescuento" [(ngModel)]="nuevoDescuento.cuenta_contable">
          </div>
          
          <button class="custom-button-ingreso" id="crearDescuentoBtn" (click)="crearDescuentos()">Crear Descuento</button>
        </div>
      </div>

      <div id="modalModificarDescuento" class="modal-perfiles" *ngIf="modals['modificarDescuento']">
        <div class="modal-content">
          <div class="modal-header">
            <span class="close" (click)="closeModal('modificarDescuento')">&times;</span>
            <div class="header-bar"></div>
            <div class="title-container">
              <h2>Modificar Descuento</h2>
            </div>
          </div>
          
          <div class="form-row">
            <label for="nombreDescuentoMod">Nombre:</label>
            <input type="text" id="nombreDescuentoMod" [(ngModel)]="descuentoSeleccionado.nombre_descuento_seleccionado" (ngModelChange)="descuentoSeleccionado.nombre_descuento_seleccionado = $event.toUpperCase()">
          </div>
          
          <div class="form-row">
            <label for="ordenDescuentoMod">Orden:</label>
            <input type="number" id="ordenDescuentoMod" [(ngModel)]="descuentoSeleccionado.orden_descuento_seleccionado">
          </div>
          
          <div class="form-row checkbox-row">
            <label>Pago en cuotas:</label>
            <input type="checkbox" [(ngModel)]="descuentoSeleccionado.cuota_descuento_seleccionado">
          </div>
          
          <div class="form-row">
            <label for="cuentaContableDescuentoMod">Cuenta Contable:</label>
            <input type="text" id="cuentaContableDescuentoMod" [(ngModel)]="descuentoSeleccionado.cuenta_contable_descuento_seleccionado">
          </div>
          
          <button class="custom-button-ingreso" (click)="modificarDescuentos()">Guardar Cambios</button>
        </div>
      </div>

      <button mat-raised-button color="primary" [disabled]="!(selectedDescuentoRows.length === 1)" (click)="openModal('modificarDescuento')">Modificar Descuento</button>
      <button mat-raised-button color="primary" [disabled]="!(selectedDescuentoRows.length > 0)" (click)="openModal('confirmacionModal', 'descuento')">Eliminar Descuento(s)</button>

      <table mat-table [dataSource]="descuentosCargados" class="mat-elevation-z8" (click)="$event.stopPropagation()">
        <ng-container matColumnDef="id">
          <th mat-header-cell *matHeaderCellDef class="mat-header"> ID </th>
          <td mat-cell *matCellDef="let descuento" class="mat-cell"> {{ descuento.id }} </td>
        </ng-container>
        
        <ng-container matColumnDef="nombre">
          <th mat-header-cell *matHeaderCellDef class="mat-header"> Nombre </th>
          <td mat-cell *matCellDef="let descuento" class="mat-cell"> {{ descuento.nombre }} </td>
        </ng-container>
        
        <ng-container matColumnDef="cuota">
          <th mat-header-cell *matHeaderCellDef class="mat-header"> Cuotas </th>
          <td mat-cell *matCellDef="let descuento" class="mat-cell"> {{ descuento.cuota ? 'Sí' : 'No' }} </td>
        </ng-container>
        
        <ng-container matColumnDef="orden">
          <th mat-header-cell *matHeaderCellDef class="mat-header"> Orden </th>
          <td mat-cell *matCellDef="let descuento" class="mat-cell"> {{ descuento.orden }} </td>
        </ng-container>
        
        <tr mat-header-row *matHeaderRowDef="columnasDesplegadasDescuentos"></tr>
        <tr mat-row *matRowDef="let row; columns: columnasDesplegadasDescuentos;" [class.selected]="isDescuentoSelected(row)" (click)="selectDescuentoRow(row)"></tr>
      </table>
    </div>
  </div>
</div>

<!-- Modales comunes -->
<div id="exitoModal" class="modal-perfiles" *ngIf="modals['exitoModal']">
  <div class="modal-content">
    <h2 style="color:white;">¡Éxito!</h2>
    <div class="exito-message" id="exitoText">Operación completada correctamente</div>
    <button class="custom-button" (click)="closeModal('exitoModal')">Cerrar</button>
  </div>
</div>

<div id="errorModal" class="modal-perfiles" *ngIf="modals['errorModal']">
  <div class="modal-content">
    <h2 style="color:white;">¡Error!</h2>
    <div class="error-icon-container">
      <i class="fas fa-exclamation-triangle icon-exclamation-triangle"></i>
    </div>
    <div class="error-message" style="color:white;">{{ errorMessage }}</div>
    <button class="custom-button" (click)="closeModal('errorModal')">Cerrar</button>
  </div>
</div>

<div id="confirmacionModal" class="modal-perfiles" *ngIf="modals['confirmacionModal']">
  <div class="modal-content">
    <h2 style="color:white;">¿Desea eliminar {{ tipoEliminacion === 'haber' ? 'el(los) haber(es)' : 'el(los) descuento(s)' }} seleccionado(s)?</h2>
    <div class="exito-message" id="exitoText"></div>
    <!-- Botones para confirmar o cancelar la acción -->
    <div class="modal-actions">
      <button class="custom-button yes-button" (click)="tipoEliminacion === 'haber' ? eliminarHaberesSeleccionados() : eliminarDescuentosSeleccionados()">Sí</button>
      <button class="custom-button no-button" (click)="closeModal('confirmacionModal')">No</button>
    </div>
  </div>
</div>