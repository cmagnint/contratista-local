<div class="admin-cuentas-container" (click)="deseleccionarFila($event)">
  
  <!-- Botones de acción -->
  <button mat-raised-button color="primary" class="custom-button" (click)="openModal('crearCuenta')">
    Crear Cuenta
  </button>
  
  <button mat-raised-button color="primary" class="custom-button" 
          [disabled]="!(selectedRows.length > 0 && selectedRows.length < 2)" 
          (click)="openModal('modificarCuenta'); $event.stopPropagation()">
    Modificar Cuenta
  </button>
  
  <button mat-raised-button color="primary" class="custom-button" 
          [disabled]="!(selectedRows.length > 0)" 
          (click)="openModal('confirmacionModal')">
    Eliminar Cuenta
  </button>

  <!-- Modal para crear cuenta -->
  <div id="modalCrearCuenta" class="modal-cuentas" *ngIf="modals['crearCuenta']" (click)="closeModal('crearCuenta')">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <div class="header-bar"></div>
        <div class="title-container">
          <h2>Crear Cuenta</h2>
        </div>
      </div>

      <h4 class="h4-subtitle">Nombre de la Cuenta:</h4>
      <input type="text" 
             class="input-cuenta" 
             [(ngModel)]="nombreCuenta" 
             (ngModelChange)="nombreCuenta = $event.toUpperCase()"
             placeholder="Ingrese el nombre de la cuenta"
             maxlength="100">
      <br><br>

      <h4 class="h4-subtitle">Cuenta Contable:</h4>
      <input type="text" 
             class="input-cuenta" 
             [(ngModel)]="cuentaContable"
             (keypress)="validateCuentaContable($event)"
             placeholder="Ej: 1.1.01.001"
             maxlength="20">
      <br><br>

      <button class="custom-button-ingreso" (click)="crearCuenta()">
        Crear Cuenta
      </button>
    </div>
  </div>

  <!-- Modal para modificar cuenta -->
  <div id="modalModificarCuenta" class="modal-cuentas" *ngIf="modals['modificarCuenta']" (click)="closeModal('modificarCuenta')">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <span class="close" (click)="closeModal('modificarCuenta')">&times;</span>
        <div class="header-bar"></div>
        <div class="title-container">
          <h2>Modificar Cuenta</h2>
        </div>
      </div>

      <h4 class="h4-subtitle">Nombre de la Cuenta:</h4>
      <input type="text" 
             class="input-cuenta" 
             [(ngModel)]="nombreCuentaNew" 
             (ngModelChange)="nombreCuentaNew = $event.toUpperCase()"
             placeholder="Ingrese el nombre de la cuenta"
             maxlength="100">
      <br><br>

      <h4 class="h4-subtitle">Cuenta Contable:</h4>
      <input type="text" 
             class="input-cuenta" 
             [(ngModel)]="cuentaContableNew"
             (keypress)="validateCuentaContable($event)"
             placeholder="Ej: 1.1.01.001"
             maxlength="20">
      <br><br>

      <h4 class="h4-subtitle">Estado:</h4>
      <div class="input-container">
        <select class="input-cuenta" [(ngModel)]="activaNew">
          <option [value]="true">ACTIVA</option>
          <option [value]="false">INACTIVA</option>
        </select>
      </div>
      <br><br>

      <button class="custom-button-ingreso" (click)="modificarCuenta()">
        Guardar Cambios
      </button>
    </div>
  </div>

  <!-- Tabla de cuentas -->
  <table mat-table [dataSource]="cuentasCargadas" class="mat-elevation-z8" (click)="$event.stopPropagation()">
    
    <ng-container matColumnDef="id">
      <th mat-header-cell *matHeaderCellDef class="mat-header">ID</th>
      <td mat-cell *matCellDef="let cuenta" class="mat-cell">{{cuenta.id}}</td>
    </ng-container>

    <ng-container matColumnDef="nombre_cuenta">
      <th mat-header-cell *matHeaderCellDef class="mat-header">Nombre Cuenta</th>
      <td mat-cell *matCellDef="let cuenta" class="mat-cell">{{cuenta.nombre_cuenta}}</td>
    </ng-container>

    <ng-container matColumnDef="cuenta_contable">
      <th mat-header-cell *matHeaderCellDef class="mat-header">Cuenta Contable</th>
      <td mat-cell *matCellDef="let cuenta" class="mat-cell">{{cuenta.cuenta_contable}}</td>
    </ng-container>

    <ng-container matColumnDef="estado">
      <th mat-header-cell *matHeaderCellDef class="mat-header">Estado</th>
      <td mat-cell *matCellDef="let cuenta" class="mat-cell">
        <span *ngIf="cuenta.activa; else inactiva" class="estado-activo">ACTIVA</span>
        <ng-template #inactiva><span class="estado-inactivo">INACTIVA</span></ng-template>
      </td>
    </ng-container>

    <tr mat-header-row *matHeaderRowDef="columnasDesplegadas"></tr>
    <tr mat-row *matRowDef="let row; columns: columnasDesplegadas;" 
        [class.selected]="isSelected(row)" 
        (click)="selectRow(row)">
    </tr>
  </table>

  <!-- Modal de confirmación para eliminar -->
  <div id="confirmacionModal" class="modal-cuentas" *ngIf="modals['confirmacionModal']">
    <div class="modal-content confirmacion-content">
      <h2 style="color: white;">¿Está seguro?</h2>
      <p style="color: white;">
        ¿Desea eliminar {{selectedRows.length}} cuenta(s) seleccionada(s)?
      </p>
      <p style="color: white; font-size: 12px;">
        Esta acción no se puede deshacer.
      </p>
      <div class="modal-actions">
        <button class="custom-button yes-button" (click)="eliminarCuentasSeleccionadas()">
          Sí, Eliminar
        </button>
        <button class="custom-button no-button" (click)="closeModal('confirmacionModal')">
          Cancelar
        </button>
      </div>
    </div>
  </div>

  <!-- Modal de éxito -->
  <div id="exitoModal" class="modal-cuentas" *ngIf="modals['exitoModal']">
    <div class="modal-content exito-content">
      <h2 style="color: white;">¡Éxito!</h2>
      <div class="exito-message">
        <i class="fas fa-check-circle icon-check"></i>
        <p>Operación realizada exitosamente</p>
      </div>
      <button class="custom-button" (click)="closeModal('exitoModal')">Cerrar</button>
    </div>
  </div>

  <!-- Modal de error -->
  <div id="errorModal" class="modal-cuentas" *ngIf="modals['errorModal']">
    <div class="modal-content error-content">
      <h2 style="color: white;">¡Error!</h2>
      <div class="error-icon-container">
        <i class="fas fa-exclamation-triangle icon-exclamation-triangle"></i>
      </div>
      <div class="error-message" style="color: white;">{{errorMessage}}</div>
      <button class="custom-button" (click)="closeModal('errorModal')">Cerrar</button>
    </div>
  </div>
</div>