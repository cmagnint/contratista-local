<div class="admin-container">
    <div class="admin-contactos">
      <div class="admin-usuarios-container" (click)="deseleccionarFila($event)">
        <button mat-raised-button color="primary" (click)="openModal('crearContacto')">Crear Contacto</button>
  
        <div id="modalCrearContacto" class="modal-perfiles" *ngIf="modals['crearContacto']">
          <div class="modal-content">
            <div class="modal-header">
              <span class="close" (click)="closeModal('crearContacto')">&times;</span>
              <div class="header-bar"></div>
              <div class="title-container">
                <h2>Crear Contacto</h2>
              </div>
            </div>
  
            <h3>Nombre Contacto:</h3>
            <input type="text" class="input-usuario" [(ngModel)]="nuevoContacto.nombre_contacto"><br><br>
  
            <h3>RUT Contacto:</h3>
            <input type="text" class="input-usuario" [(ngModel)]="nuevoContacto.rut_contacto" (input)="formatRUT($event)"><br><br>
  
            <h3>Teléfono:</h3>
            <input type="text" class="input-usuario" [(ngModel)]="nuevoContacto.telefono"><br><br>
  
            <h3>Correo:</h3>
            <input type="email" class="input-usuario" [(ngModel)]="nuevoContacto.correo"><br><br>
  
            <div class="dropdown-container">
              <h3>Cliente:</h3>
              <div class="dropdown">
                <button class="dropdown-button" (click)="toggleDropdownCliente()">SELECCIONAR CLIENTE</button>
                <div id="sociedades-dropdown" class="dropdown-content" [class.show]="dropdownOpenCliente">
                  <ng-container *ngFor="let cliente of clientesCargados">
                    <label [class.disabled]="nuevoContacto.cliente !== null && nuevoContacto.cliente !== cliente.id">
                      <input type="checkbox"
                             [checked]="nuevoContacto.cliente === cliente.id"
                             (change)="toggleSelectionCliente(cliente.id)"
                             [disabled]="nuevoContacto.cliente !== null && nuevoContacto.cliente !== cliente.id">
                      {{ cliente.nombre }}
                    </label>
                  </ng-container>
                </div>
              </div>
  
              <h3>Campo Cliente:</h3>
              <div class="dropdown" *ngIf="nuevoContacto.cliente !== null">
                <button class="dropdown-button" (click)="toggleDropdownCampoCliente()">SELECCIONAR CAMPO</button>
                <div id="campo-dropdown" class="dropdown-content" [class.show]="dropdownOpenCampoCliente">
                  <ng-container *ngFor="let cliente of clientesCargados">
                    <div *ngIf="nuevoContacto.cliente === cliente.id">
                      <strong>{{ cliente.nombre }}</strong>
                      <ng-container *ngFor="let campo of cliente.campos_personalizados">
                        <label>
                          <input type="checkbox"
                                 [checked]="nuevoContacto.campo_cliente === campo.id"
                                 (change)="nuevoContacto.campo_cliente = campo.id">
                          {{ campo.nombre_campo }}
                        </label>
                      </ng-container>
                    </div>
                  </ng-container>
                </div>
              </div>
  
              <h3>Área Cliente:</h3>
              <div class="dropdown">
                <button class="dropdown-button" (click)="toggleDropdownAreaCliente()">SELECCIONAR AREA</button>
                <div id="area-dropdown" class="dropdown-content" [class.show]="dropdownOpenAreaCliente">
                  <ng-container *ngFor="let area of areasCargadas">
                    <label [class.disabled]="nuevoContacto.area_cliente !== null && nuevoContacto.area_cliente !== area.id">
                      <input type="checkbox" [checked]="nuevoContacto.area_cliente === area.id" (change)="toggleSelectionArea(area.id)"
                             [disabled]="nuevoContacto.area_cliente !== null && nuevoContacto.area_cliente !== area.id">
                      {{ area.nombre }}
                    </label>
                  </ng-container>
                </div>
              </div>
  
              <h3>Cargo Cliente:</h3>
              <div class="dropdown" *ngIf="nuevoContacto.area_cliente !== null">
                <button class="dropdown-button" (click)="toggleDropdownCargoCliente()">SELECCIONAR CARGO</button>
                <div id="sucursales-dropdown" class="dropdown-content" [class.show]="dropdownOpenCargoCliente">
                  <ng-container *ngFor="let cargo of cargosClientes">
                    <div *ngIf="cargo.area_id === nuevoContacto.area_cliente">
                      <ng-container *ngFor="let c of cargo.cargos">
                        <label>
                          <input type="checkbox"
                                 [disabled]="nuevoContacto.cargo_cliente !== null && nuevoContacto.cargo_cliente !== c.id"
                                 [checked]="nuevoContacto.cargo_cliente === c.id"
                                 (change)="toggleSelectionCargo(c.id)">
                          {{ c.name }}
                        </label>
                      </ng-container>
                    </div>
                  </ng-container>
                </div>
              </div>
            </div>
  
            <button class="custom-button" (click)="crearContacto()">Crear Contacto</button>
          </div>
        </div>
  
        <!-- Modal Modificar Contacto -->
        <div id="modalModificarContacto" class="modal-perfiles" *ngIf="modals['modificarContacto']">
          <div class="modal-content">
            <div class="modal-header">
              <span class="close" (click)="closeModal('modificarContacto')">&times;</span>
              <div class="header-bar"></div>
              <div class="title-container">
                <h2>Modificar Contacto</h2>
              </div>
            </div>
  
            <h3>Nombre Contacto:</h3>
            <input type="text" class="input-usuario" [(ngModel)]="contactoSeleccionado.nombre_contacto"><br><br>
  
            <h3>RUT Contacto:</h3>
            <input type="text" class="input-usuario" [(ngModel)]="contactoSeleccionado.rut_contacto"><br><br>
  
            <h3>Teléfono:</h3>
            <input type="text" class="input-usuario" [(ngModel)]="contactoSeleccionado.telefono"><br><br>
  
            <h3>Correo:</h3>
            <input type="email" class="input-usuario" [(ngModel)]="contactoSeleccionado.correo"><br><br>
  
            <h3>Cliente:</h3>
            <div class="dropdown">
              <button class="dropdown-button" (click)="toggleDropdownCliente()">SELECCIONAR CLIENTE</button>
              <div id="sociedades-dropdown" class="dropdown-content" [class.show]="dropdownOpenCliente">
                <ng-container *ngFor="let cliente of clientesCargados">
                  <label [class.disabled]="contactoSeleccionado.cliente !== null && contactoSeleccionado.cliente !== cliente.id">
                    <input type="checkbox"
                           [checked]="contactoSeleccionado.cliente === cliente.id"
                           (change)="toggleSelectionCliente(cliente.id)"
                           [disabled]="contactoSeleccionado.cliente !== null && contactoSeleccionado.cliente !== cliente.id">
                    {{ cliente.nombre }}
                  </label>
                </ng-container>
              </div>
            </div>
  
            <h3>Campo Cliente:</h3>
            <div class="dropdown" *ngIf="contactoSeleccionado.cliente !== null">
              <button class="dropdown-button" (click)="toggleDropdownCampoCliente()">SELECCIONAR CAMPO</button>
              <div id="campo-dropdown" class="dropdown-content" [class.show]="dropdownOpenCampoCliente">
                <ng-container *ngFor="let cliente of clientesCargados">
                  <div *ngIf="contactoSeleccionado.cliente === cliente.id">
                    <strong>{{ cliente.nombre }}</strong>
                    <ng-container *ngFor="let campo of cliente.campos_personalizados">
                      <label>
                        <input type="checkbox"
                               [checked]="contactoSeleccionado.campo_cliente === campo.id"
                               (change)="contactoSeleccionado.campo_cliente = campo.id">
                        {{ campo.nombre_campo }}
                      </label>
                    </ng-container>
                  </div>
                </ng-container>
              </div>
            </div>
  
            <h3>Área Cliente:</h3>
            <div class="dropdown">
              <button class="dropdown-button" (click)="toggleDropdownAreaCliente()">SELECCIONAR AREA</button>
              <div id="area-dropdown" class="dropdown-content" [class.show]="dropdownOpenAreaCliente">
                <ng-container *ngFor="let area of areasCargadas">
                  <label [class.disabled]="contactoSeleccionado.area_cliente !== null && contactoSeleccionado.area_cliente !== area.id">
                    <input type="checkbox" [checked]="contactoSeleccionado.area_cliente === area.id" (change)="toggleSelectionArea(area.id)" [disabled]="contactoSeleccionado.area_cliente !== null && contactoSeleccionado.area_cliente !== area.id">
                    {{ area.nombre }}
                  </label>
                </ng-container>
              </div>
            </div>
  
            <h3>Cargo Cliente:</h3>
            <div class="dropdown">
              <button class="dropdown-button" (click)="toggleDropdownCargoCliente()">SELECCIONAR CARGO</button>
              <div id="sucursales-dropdown" class="dropdown-content" [class.show]="dropdownOpenCargoCliente">
                <ng-container *ngFor="let cargo of cargosClientes">
                  <div *ngIf="cargo.area_id === contactoSeleccionado.area_cliente">
                    <ng-container *ngFor="let c of cargo.cargos">
                      <label>
                        <input type="checkbox"
                               [disabled]="contactoSeleccionado.cargo_cliente !== null && contactoSeleccionado.cargo_cliente !== c.id"
                               [checked]="contactoSeleccionado.cargo_cliente === c.id"
                               (change)="toggleSelectionCargo(c.id)">
                        {{ c.name }}
                      </label>
                    </ng-container>
                  </div>
                </ng-container>
              </div>
            </div>
  
            <button class="custom-button-ingreso" (click)="modificarContacto()">Modificar Contacto</button>
          </div>
        </div>
  
        <button mat-raised-button color="primary" [disabled]="!(selectedRows.length>0 && selectedRows.length<2)" (click)="openModal('modificarContacto')">Modificar Contacto</button>
        <button mat-raised-button color="primary" [disabled]="!(selectedRows.length>0)" (click)="openModal('confirmacionModal')">Eliminar Contacto(s)</button>
  
        <table mat-table [dataSource]="contactosCargados" class="mat-elevation-z8" (click)="$event.stopPropagation()">
          <ng-container matColumnDef="nombre_contacto">
            <th mat-header-cell *matHeaderCellDef class="mat-header"> Nombre Contacto </th>
            <td mat-cell *matCellDef="let contacto" class="mat-cell"> {{ contacto.nombre_contacto }} </td>
          </ng-container>
          <ng-container matColumnDef="rut_contacto">
            <th mat-header-cell *matHeaderCellDef class="mat-header"> RUT Contacto </th>
            <td mat-cell *matCellDef="let contacto" class="mat-cell"> {{ contacto.rut_contacto }} </td>
          </ng-container>
          <ng-container matColumnDef="telefono">
            <th mat-header-cell *matHeaderCellDef class="mat-header"> Teléfono </th>
            <td mat-cell *matCellDef="let contacto" class="mat-cell"> {{ contacto.telefono }} </td>
          </ng-container>
          <ng-container matColumnDef="correo">
            <th mat-header-cell *matHeaderCellDef class="mat-header"> Correo </th>
            <td mat-cell *matCellDef="let contacto" class="mat-cell"> {{ contacto.correo }} </td>
          </ng-container>
          <ng-container matColumnDef="cliente">
            <th mat-header-cell *matHeaderCellDef class="mat-header"> Cliente </th>
            <td mat-cell *matCellDef="let contacto" class="mat-cell"> {{ contacto.nombre_cliente }} </td>
          </ng-container>
          <ng-container matColumnDef="campo_cliente">
            <th mat-header-cell *matHeaderCellDef class="mat-header"> Campo </th>
            <td mat-cell *matCellDef="let contacto" class="mat-cell"> {{ contacto.nombre_campo_cliente }} </td>
          </ng-container>
          <ng-container matColumnDef="area_cliente">
            <th mat-header-cell *matHeaderCellDef class="mat-header"> Área laboral</th>
            <td mat-cell *matCellDef="let contacto" class="mat-cell"> {{ contacto.nombre_area_cliente }} </td>
          </ng-container>
          <ng-container matColumnDef="cargo_cliente">
            <th mat-header-cell *matHeaderCellDef class="mat-header"> Cargo laboral </th>
            <td mat-cell *matCellDef="let contacto" class="mat-cell"> {{ contacto.nombre_cargo_cliente }} </td>
          </ng-container>
  
          <tr mat-header-row *matHeaderRowDef="columnasDesplegadasContactos"></tr>
          <tr mat-row *matRowDef="let row; columns: columnasDesplegadasContactos;" [class.selected]="isSelected(row)" (click)="selectRow(row)"></tr>
        </table>
      </div>
    </div>
  </div>
  
  <div id="exitoModal" class="modal-perfiles" *ngIf="modals['exitoModal']">
    <div class="modal-content">
      <h2 style="color:white;">¡Éxito!</h2>
      <div class="exito-message" id="exitoText"></div>
      <button class="custom-button" (click)="closeModal('exitoModal')">Cerrar</button>
    </div>
  </div>
  
  <div id="errorModal" class="modal-perfiles" *ngIf="modals['errorModal']">
    <div class="modal-content">
      <h2 style="color:white;">¡Error!</h2>
      <div class="error-icon-container">
        <i class="fas fa-exclamation-triangle icon-exclamation-triangle"></i>
      </div>
      <div class="error-message" style="color:white;">{{ errorMessage }}</div>
      <button class="custom-button" (click)="closeModal('errorModal')">Cerrar</button>
    </div>
  </div>
  
  <div id="confirmacionModal" class="modal-perfiles" *ngIf="modals['confirmacionModal']">
    <div class="modal-content">
      <h2 style="color:white;">¿Desea eliminar el(los) contacto(s) seleccionado(s)?</h2>
      <div class="exito-message" id="exitoText"></div>
      <div class="modal-actions">
        <button class="custom-button yes-button" (click)="eliminarContactosSeleccionados()">Sí</button>
        <button class="custom-button no-button" (click)="closeModal('confirmacionModal')">No</button>
      </div>
    </div>
  </div>
  